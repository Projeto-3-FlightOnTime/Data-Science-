# -*- coding: utf-8 -*-
"""threshold_wrapper.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1tbGGxgXBcVbgJz0z1iUoVu10WMqZF4YD

# ðŸ§  Modelo Preditivo de Atraso de Voos com Threshold Encapsulado

### ðŸ“Œ DescriÃ§Ã£o

Este projeto implementa um modelo preditivo de atraso de voos baseado em Random Forest, com a regra de decisÃ£o (threshold = 0.4) encapsulada no prÃ³prio modelo.

A encapsulaÃ§Ã£o do threshold garante que a regra de negÃ³cio seja aplicada de forma consistente em produÃ§Ã£o, evitando dependÃªncia de lÃ³gica adicional no backend ou risco de inconsistÃªncia entre ambientes.

O modelo Ã© exportado utilizando joblib e depende de um wrapper Python (ModeloComThreshold) definido como mÃ³dulo importÃ¡vel, permitindo que o backend carregue o modelo sem erros de serializaÃ§Ã£o.

### âš™ï¸ Como o Threshold Ã© Aplicado

O modelo interno retorna probabilidades de atraso (predict_proba)

A classe ModeloComThreshold aplica a regra:

atraso = 1 se P(atraso) â‰¥ 0.4

atraso = 0 caso contrÃ¡rio

O mÃ©todo:

* predict_proba() â†’ retorna probabilidades

* predict() â†’ retorna a decisÃ£o final, jÃ¡ com threshold aplicado
"""

from sklearn.base import BaseEstimator, ClassifierMixin
import numpy as np

class ModeloComThreshold(BaseEstimator, ClassifierMixin):
    def __init__(self, modelo, threshold=0.4):
        self.modelo = modelo
        self.threshold = threshold

        if hasattr(modelo, "classes_"):
            self.classes_ = modelo.classes_

    def predict_proba(self, X):
        # CONTRATO: retorna somente probabilidade
        return self.modelo.predict_proba(X)

    def predict(self, X):
        # DecisÃ£o sempre derivada da probabilidade
        proba = self.modelo.predict_proba(X)[:, 1]
        return (proba >= self.threshold).astype(int)

    def decision_function(self, X):
        # Opcional, mas excelente para auditoria/monitoramento
        return self.modelo.predict_proba(X)[:, 1] - self.threshold